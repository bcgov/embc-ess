<div *ngIf="!summaryMode">
  <!-- ADD AN EVACUEE / EDIT EVACUEE REGISTRATION -->
  <h1 class="mt-4">{{pageTitle}}</h1>

  <p *ngIf="createMode">
    Before starting a new evacuee registration, use the search tool on your dashboard to confirm that the evacuee hasnâ€™t already registered.
  </p>

  <p>
    <small>
      All required fields are marked with an asterisk *
    </small>
  </p>

  <!-- COLLECTION NOTICE AND AUTHORIZATION -->
  <div class="mt-4">
    <h2 class="blue-header font-weight-bold">COLLECTION NOTICE AND AUTHORIZATION</h2>
    <section class="padded-section">
      <!-- <input type="checkbox" class="form-check-input" [formControl]="declarationAndConsent"> -->
      <p>
        <small>
          Emergency Management BC (EMBC) will collect your personal information for the purpose of providing you with emergency services in accordance with section 26(c) of the Freedom of Information and Protection of Privacy Act (FoIPPA). EMBC will also collect the information as per section 26(e) of FoIPPA in order to evaluate the ESS program. Should you have any questions about the collection, use, or disclosure of personal information, please contact the ESS Call Centre Manager at PO Box 9201, STN PROV GOVT, Victoria, BC, V8W 9J1 or by phone toll free at 1-800-585-9559.
        </small>
      </p>
      <p>
        <small>
          By submitting your email address, you authorize the Emergency Management BC to communicate with you by email about your registration and to invite you to provide feedback about your experience.
        </small>
      </p>
    </section>
  </div>

  <form novalidate [formGroup]="form">
    <!-- TASK NUMBER & PLACE OF REGISTRATION -->
    <div class="mt-4">
      <h2 class="blue-header font-weight-bold">TASK NUMBER &amp; PLACE OF REGISTRATION</h2>
      <div class="form-row">
        <app-attention-icon></app-attention-icon>
        <app-form-field required="true" class="col">
          <label for="incidentTask">Task Number</label>
          <select [compareWith]="compareById" [class.is-invalid]="invalid('incidentTask')" class="form-control" formControlName="incidentTask" id="incidentTask">
            <option [ngValue]="null">-- Select task number</option>
            <option [ngValue]="incident" *ngFor="let incident of incidentTasks$ | async">
              {{incident.taskNumber}}
              <span *ngIf="incident.community">
                <span *ngIf="incident.community.name"> - {{incident.community.name}}</span>
                <span *ngIf="!incident.community.name"> - {{incident.community.regionalDistrict.name}}</span>
              </span>
            </option>
          </select>
          <span *ngIf="submitted" class="invalid-feedback">{{e.incidentTask}}</span>
        </app-form-field>
        <div class="d-flex align-items-center col-md-7">
          <small class="text-muted">
            If the task number is not listed please contact your supervisor.
          </small>
        </div>
      </div>
      <div class="form-row">
        <app-attention-icon></app-attention-icon>
        <app-form-field class="col-md-8" required="true" tooltip="Tool Tip: The location where you are registering the evacuees.">
          <label for="facility">Facility Name / Registration Location</label>
          <input type="text" [class.is-invalid]="invalid('facility')" class="form-control" formControlName="facility" id="facility" autocomplete="off">
          <span *ngIf="submitted" class="invalid-feedback">{{e.facility}}</span>
        </app-form-field>
      </div>
      <div class="form-row">
        <app-attention-icon></app-attention-icon>
        <app-form-field class="col" required="true" tooltip="Tool Tip: A host community is the community where the registration is taking place and the Reception Centre is located.">
          <label for="hostCommunity">Host Community</label>
          <app-communities-select [class.is-invalid]="invalid('hostCommunity')" [myParent]="form" myFormControlName="hostCommunity" myId="hostCommunity"></app-communities-select>
          <span *ngIf="submitted" class="invalid-feedback">{{e.hostCommunity}}</span>
        </app-form-field>
        <div class="d-flex align-items-center col-md-7">
          <small class="text-muted">
            If the community is not listed please select nearest community and notify your supervisor.
          </small>
        </div>
      </div>
    </div>

    <!-- RESTRICTION // TODO: restricted files not handled in V1 -->
    <!-- <div class="mt-4">
      <h2 class="blue-header font-weight-bold">RESTRICTION</h2>
      <p class="required">Concerned family and friends may inquire about you and your family because of the emergency. We would like to provide these people with some information about you. Please check "Yes" if you <u>do not</u> want EMBC to disclose your location and the contact information for you and your family members?</p>
      <div class="form-check">
        <input type="checkbox" class="form-check-input" formControlName="restrictedAccess" id="restrictedAccess">
        <label class="form-check-label" for="restrictedAccess">Yes, I <u>do not</u> want EMBC to disclose my personal information to concerned family and friends.</label>
      </div>
    </div> -->

    <!-- RESTRICTION -->
    <div class="feature-block mt-4">
      <h2 class="required mt-0">Restriction</h2>
      <p>
        Concerned family and friends may inquire about you and your family because of the emergency. We would like to provide these people with some information about you.<br>
        <strong>May we disclose your location and the contact information for you and your family members?</strong>
      </p>
      <div class="form-check">
        <input type="radio" class="form-check-input" name="restriction" [checked]="activeForm" (click)="disableInput(false)" id="restrictionFalse">
        <label class="form-check-label" for="restrictionFalse">
          <strong>Yes</strong>
        </label>
      </div>
      <div class="form-check">
        <input type="radio" class="form-check-input" name="restriction" [checked]="!activeForm" (click)="disableInput(true)" id="restrictionTrue">
        <label class="form-check-label" for="restrictionTrue">
          <strong>No</strong> - (Emergency Support Services Team: Requires an authorized team member to complete the form manually.)
        </label>
      </div>
    </div>

    <!-- EMERGENCY SUPPORT SERVICES TEAM HANDLING NOTE -->
    <div *ngIf="!activeForm" class="mt-4">
      <h1>Emergency Support Services Team Handling Note</h1>
      <p>
        Privacy is important. Please locate a volunteer that is trained to collect and handle sensitive information.
      </p>
      <p>
        This does not change the support offered but does change the process of collecting and handling information. This restricts other Emergency Support Services team members from seeing the registration.
      </p>
      <a routerLink="/dashboard">Return to the Emergency Support Services Dashboard</a>
    </div>

    <div *ngIf="activeForm">
      <!-- EVACUEE DETAILS -->
      <div formGroupName="headOfHousehold" class="mt-4">
        <h2 class="blue-header font-weight-bold">EVACUEE DETAILS</h2>
        <app-form-field required="true">
          <label for="lastName">Last Name</label>
          <input type="text" [class.is-invalid]="invalid('headOfHousehold.lastName')" class="form-control" formControlName="lastName" id="lastName" autocomplete="off">
          <span *ngIf="submitted" class="invalid-feedback">{{e.headOfHousehold?.lastName}}</span>
        </app-form-field>
        <app-form-field required="true">
          <label for="firstName">First Name</label>
          <input type="text" [class.is-invalid]="invalid('headOfHousehold.firstName')" class="form-control" formControlName="firstName" id="firstName" autocomplete="off">
          <span *ngIf="submitted" class="invalid-feedback">{{e.headOfHousehold?.firstName}}</span>
        </app-form-field>
        <div class="form-row">
          <app-form-field class="col">
            <label for="initials">Initial</label>
            <input type="text" class="form-control" formControlName="initials" id="initials" autocomplete="off">
          </app-form-field>
          <app-form-field class="col">
            <label for="nickname">Preferred Name</label>
            <input type="text" class="form-control" formControlName="nickname" id="nickname" autocomplete="off">
          </app-form-field>
        </div>
        <div class="form-row">
          <app-form-field class="col">
            <label for="gender">Gender</label>
            <select class="form-control" formControlName="gender" id="gender">
              <option [ngValue]="null">Please select--</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="x">X</option>
            </select>
          </app-form-field>
          <app-form-field class="col" required="true">
            <label for="dob">Date of Birth</label>
            <input type="text" placeholder="yyyy-mm-dd" [textMask]="{mask: dateMask, showMask: true}" [class.is-invalid]="invalid('headOfHousehold.dob')" class="form-control" formControlName="dob" id="dob" autocomplete="off">
            <small>(Format: yyyy-mm-dd)</small>
            <span *ngIf="submitted" class="invalid-feedback">{{e.headOfHousehold.dob}}</span>
          </app-form-field>
        </div>
      </div>

      <!-- EVACUEE FAMILY INFORMATION -->
      <div class="mt-4">
        <h2 class="blue-header font-weight-bold">EVACUEE FAMILY INFORMATION</h2>
        <p class="required">
          Are you registering family members who live in the same household with you whom you know are safe?
        </p>
        <div class="form-group mb-0">
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('registeringFamilyMembers')" class="form-check-input" value="yes" formControlName="registeringFamilyMembers" id="registeringFamilyMembersYes">
            <label class="form-check-label" for="registeringFamilyMembersYes">Yes</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('registeringFamilyMembers')" class="form-check-input" value="no" formControlName="registeringFamilyMembers" id="registeringFamilyMembersNo">
            <label class="form-check-label" for="registeringFamilyMembersNo">No</label>
          </div>
          <span [class.d-block]="invalid('registeringFamilyMembers')" class="invalid-feedback">{{e.registeringFamilyMembers}}</span>
        </div>
        <div formArrayName="familyMembers">
          <!-- TODO: Refactor into sub-component -->
          <div *ngFor="let entry of familyMembers.controls; index as i;" [formGroupName]="i" class="feature-block card p-0 mt-4">
            <div class="card-body">
              <div class="row mt-0">
                <div class="col">
                  <label class="required" for="lastName-{{i}}">Last Name</label>
                  <input type="text" [class.is-invalid]="invalid('lastName', entry)" class="form-control" formControlName="lastName" id="lastName-{{i}}" autocomplete="off">
                  <span *ngIf="submitted" class="invalid-feedback">Please enter a last name.</span>
                </div>
                <div class="col">
                  <!-- not yet implemented -->
                  <!-- <label>Same as main applicant.</label>
                  <div class="form-check" for="sameLastNameAsEvacuee">
                    <input type="checkbox" class="form-check-input" [value]="true" formControlName="sameLastNameAsEvacuee" id="sameLastNameAsEvacuee">
                  </div> -->
                </div>
              </div>
              <div class="row mt-2">
                <div class="col">
                  <label class="required" for="firstName-{{i}}">First Name</label>
                  <input type="text" [class.is-invalid]="invalid('firstName', entry)" class="form-control" formControlName="firstName" id="firstName-{{i}}" autocomplete="off">
                  <span *ngIf="submitted" class="invalid-feedback">Please enter a first name.</span>
                </div>
                <div class="col">
                  <label for="initials-{{i}}">Initial</label>
                  <input type="text" class="form-control" formControlName="initials" id="initials-{{i}}" autocomplete="off">
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-6">
                  <label class="required" for="relationshipToEvacuee-{{i}}">Relationship to evacuee</label>
                  <select [compareWith]="compareById" [class.is-invalid]="invalid('relationshipToEvacuee', entry)" class="form-control" formControlName="relationshipToEvacuee" id="relationshipToEvacuee-{{i}}">
                    <option [ngValue]="null">Please select--</option>
                    <option *ngFor="let item of relationshipTypes$ | async" [ngValue]="item">
                      {{item.description}}
                    </option>
                  </select>
                  <span *ngIf="submitted" class="invalid-feedback">Please state your relationship to this family member.</span>
                </div>
                <div class="col">
                  <label for="gender-{{i}}">Gender</label>
                  <select class="form-control" formControlName="gender" id="gender-{{i}}">
                    <option [ngValue]="null">Please select--</option>
                    <option value="female">Female</option>
                    <option value="male">Male</option>
                    <option value="x">X</option>
                  </select>
                </div>
                <div class="col">
                  <label class="required" for="dob-{{i}}">Date of Birth</label>
                  <input type="text" placeholder="yyyy-mm-dd" [textMask]="{mask: dateMask, showMask: true}" [class.is-invalid]="invalid('dob', entry)" class="form-control" formControlName="dob" id="dob-{{i}}" autocomplete="off">
                  <small>(Format: yyyy-mm-dd)</small>
                  <span *ngIf="submitted && hasErrors('dob', entry, ['required'])" class="invalid-feedback">Please enter a date of birth.</span>
                  <ng-container *ngIf="submitted && hasErrors('dob', entry, ['date', 'maxDate'])">
                    <span *ngIf="hasErrors('dob', entry, ['date']); else maxDate" class="invalid-feedback">Please enter a valid date.</span>
                    <ng-template #maxDate>
                      <span class="invalid-feedback">Date of birth must be today or in the past.</span>
                    </ng-template>
                  </ng-container>
                </div>
              </div>
            </div>
            <div class="card-footer">
              <app-fa-link icon="times" class="float-left" (click)="removeFamilyMember(i)">
                Remove
              </app-fa-link>
              <app-fa-link icon="plus-circle" color="#669900" class="float-right" (click)="addFamilyMember()">
                Add another contact
              </app-fa-link>
            </div>
          </div>
        </div>
      </div>

      <!-- PRIMARY RESIDENCE & CONTACT DETAILS -->
      <div class="mt-4">
        <h2 class="blue-header font-weight-bold">PRIMARY RESIDENCE &amp; CONTACT DETAILS</h2>
        <p class="required">
          Is your primary residence within BC?
        </p>
        <div class="form-group mb-0">
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('primaryResidenceInBC')" class="form-check-input" [value]="true" formControlName="primaryResidenceInBC" id="primaryResidenceInBCTrue">
            <label class="form-check-label" for="primaryResidenceInBCTrue">Yes</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('primaryResidenceInBC')" class="form-check-input" [value]="false" formControlName="primaryResidenceInBC" id="primaryResidenceInBCFalse">
            <label class="form-check-label" for="primaryResidenceInBCFalse">No</label>
          </div>
          <span [class.d-block]="invalid('primaryResidenceInBC')" class="invalid-feedback">{{e.primaryResidenceInBC}}</span>
        </div>
        <p class="mt-3">
          <small>
            <strong>Primary residence:</strong> Refers to a dwelling where a person usually lives. It may be a house or apartment, and at any given time, a person shall not have more than one primary residence. Primary residence is the legal residence of an individual and is usually determined based on the mailing address, telephone listing, the time spent at the residence per year and normally appears on their documents and is associated with income tax calculation, home owner's grant, etc.
          </small>
        </p>
        <div *ngIf="form.value.primaryResidenceInBC !== null" class="feature-block mt-4">
          <app-address-selector [parent]="f.primaryResidence" [touched]="submitted" [withinBC]="form.value.primaryResidenceInBC"></app-address-selector>
          <div class="row mt-0">
            <div class="col">
              <label for="phoneNumber">Telephone / Mobile Number</label>
              <input type="text" [class.is-invalid]="invalid('phoneNumber')" class="form-control" [textMask]="{mask: phoneMask, showMask: true}" formControlName="phoneNumber" id="phoneNumber" autocomplete="off">
              <small class="d-block" *ngIf="!!form.value.primaryResidenceInBC">(Format: 999-999-9999)</small>
              <span *ngIf="submitted" class="invalid-feedback">{{e.phoneNumber}}</span>
            </div>
            <div class="col">
              <label for="phoneNumberAlt">Alternate Telephone / Mobile Number</label>
              <input type="text" [class.is-invalid]="invalid('phoneNumberAlt')" class="form-control" [textMask]="{mask: phoneMask, showMask: true}" formControlName="phoneNumberAlt" id="phoneNumberAlt" autocomplete="off">
              <small class="d-block" *ngIf="!!form.value.primaryResidenceInBC">(Format: 999-999-9999)</small>
              <span *ngIf="submitted" class="invalid-feedback">{{e.phoneNumberAlt}}</span>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col">
              <label for="email">Email Address</label>
              <input type="email" [class.is-invalid]="invalid('email')" class="form-control" formControlName="email" id="email" autocomplete="off">
              <span *ngIf="submitted" class="invalid-feedback">{{e.email}}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- MAILING ADDRESS -->
      <div class="mt-4">
        <h2 class="blue-header font-weight-bold">MAILING ADDRESS</h2>
        <p class="required">
          Is your mailing address the same as your primary residence?
        </p>
        <div class="form-group mt-4 mb-0">
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('mailingAddressSameAsPrimary')" class="form-check-input" [value]="true" formControlName="mailingAddressSameAsPrimary" id="mailingAddressSameAsPrimaryTrue">
            <label class="form-check-label" for="mailingAddressSameAsPrimaryTrue">Yes</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('mailingAddressSameAsPrimary')" class="form-check-input" [value]="false" formControlName="mailingAddressSameAsPrimary" id="mailingAddressSameAsPrimaryFalse">
            <label class="form-check-label" for="mailingAddressSameAsPrimaryFalse">No</label>
          </div>
          <span [class.d-block]="invalid('mailingAddressSameAsPrimary')" class="invalid-feedback">{{e.mailingAddressSameAsPrimary}}</span>
        </div>
        <div *ngIf="form.value.mailingAddressSameAsPrimary === false" class="feature-block mt-4 pb-0">
          <p class="required">
            Is your mailing address within BC?
          </p>
          <div class="form-group mb-0 pb-4">
            <div class="form-check">
              <input type="radio" class="form-check-input" [value]="true" formControlName="mailingAddressInBC" id="mailingAddressInBCTrue">
              <label class="form-check-label" for="mailingAddressInBCTrue">Yes</label>
            </div>
            <div class="form-check">
              <input type="radio" class="form-check-input" [value]="false" formControlName="mailingAddressInBC" id="mailingAddressInBCFalse">
              <label class="form-check-label" for="mailingAddressInBCFalse">No</label>
            </div>
          </div>
          <span [class.d-block]="invalid('mailingAddressInBC')" class="invalid-feedback">{{e.mailingAddressInBC}}</span>
          <div *ngIf="form.value.mailingAddressInBC !== null" class="mt-0">
            <app-address-selector [parent]="f.mailingAddress" [touched]="submitted" [withinBC]="form.value.mailingAddressInBC"></app-address-selector>
          </div>
        </div>
      </div>

      <!-- BRIEF STATEMENT OF HOW THE PERSON/FAMILY WERE AFFECTED BY THE DISASTER -->
      <div class="mt-4">
        <h2 class="blue-header font-weight-bold">BRIEF STATEMENT OF HOW THE PERSON/FAMILY WERE AFFECTED BY THE DISASTER</h2>
        <div class="form-row">
          <app-attention-icon></app-attention-icon>
          <p class="col">
            Please do not include any personal/medical information pertaining to the evacuee and their family.
          </p>
        </div>
        <div class="form-row">
          <div class="col">
            <textarea class="form-control" formControlName="disasterAffectDetails" placeholder="Please specify" rows="4"></textarea>
          </div>
        </div>
      </div>

      <!-- INSURANCE -->
      <div class="mt-4">
        <h2 class="blue-header font-weight-bold">INSURANCE</h2>
        <p class="required">
          Do you have insurance to cover your immediate needs?
        </p>
        <div class="form-group mb-0">
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('insuranceCode')" class="form-check-input" value="yes" formControlName="insuranceCode" id="insuranceCodeYes">
            <label class="form-check-label" for="insuranceCodeYes">Yes</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('insuranceCode')" class="form-check-input" value="yes-unsure" formControlName="insuranceCode" id="insuranceCodeYesUnsure">
            <label class="form-check-label" for="insuranceCodeYesUnsure">Yes, but I'm not sure if I have coverage for this event</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('insuranceCode')" class="form-check-input" value="no" formControlName="insuranceCode" id="insuranceCodeNo">
            <label class="form-check-label" for="insuranceCodeNo">No</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('insuranceCode')" class="form-check-input" value="unsure" formControlName="insuranceCode" id="insuranceCodeUnsure">
            <label class="form-check-label" for="insuranceCodeUnsure">I don't know</label>
          </div>
          <span [class.d-block]="invalid('insuranceCode')" class="invalid-feedback">{{e.insuranceCode}}</span>
        </div>
        <div *ngIf="(form.value.insuranceCode=='yes')||(form.value.insuranceCode=='yes-unsure')" class="alert alert-warning" role="alert">
          <p class="alert-heading h4 mt-2">Assist the evacuee in contacting their insurance agent to confirm coverage for this event.</p>
        </div>
      </div>

      <!-- ADDITIONAL INFORMATION -->
      <div class="mt-4">
        <h2 class="blue-header font-weight-bold">ADDITIONAL INFORMATION</h2>

        <!-- DIETARY REQUIREMENTS -->
        <div class="form-row mt-0">
          <app-attention-icon></app-attention-icon>
          <p class="col required">
            Do you have dietary requirements?
          </p>
        </div>
        <div class="form-group mb-0">
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('dietaryNeeds')" class="form-check-input" [value]="true" formControlName="dietaryNeeds" id="dietaryNeedsTrue">
            <label class="form-check-label" for="dietaryNeedsTrue">Yes</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('dietaryNeeds')" class="form-check-input" [value]="false" formControlName="dietaryNeeds" id="dietaryNeedsFalse">
            <label class="form-check-label" for="dietaryNeedsFalse">No</label>
          </div>
          <span [class.d-block]="invalid('dietaryNeeds')" class="invalid-feedback">{{e.dietaryNeeds}}</span>
        </div>

        <div *ngIf="form.value.dietaryNeeds" class="feature-block">
          <label>Please specify</label>
          <input type="text" [class.is-invalid]="invalid('dietaryNeedsDetails')" class="form-control" formControlName="dietaryNeedsDetails" autocomplete="off">
          <span *ngIf="submitted" class="invalid-feedback">{{e.dietaryNeedsDetails}}</span>
        </div>

        <!-- MEDICATION -->
        <div class="form-row mt-4">
          <app-attention-icon></app-attention-icon>
          <p class="required">
            Do you (or anyone registering with you) take medication?
          </p>
        </div>
        <div class="form-group mb-0">
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('medicationNeeds')" class="form-check-input" [value]="true" formControlName="medicationNeeds" id="medicationNeedsTrue">
            <label class="form-check-label" for="medicationNeedsTrue">Yes</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('medicationNeeds')" class="form-check-input" [value]="false" formControlName="medicationNeeds" id="medicationNeedsFalse">
            <label class="form-check-label" for="medicationNeedsFalse">No</label>
          </div>
          <span [class.d-block]="invalid('medicationNeeds')" class="invalid-feedback">{{e.medicationNeeds}}</span>
        </div>
        <div *ngIf="form.value.medicationNeeds" class="feature-block">
          <p class="required">
            Do you have sufficient supply for the next 72 hours?
          </p>
          <div class="form-group mb-0">
            <div class="form-check">
              <input type="radio" [class.is-invalid]="invalid('hasThreeDayMedicationSupply')" class="form-check-input" [value]="true" formControlName="hasThreeDayMedicationSupply" id="hasThreeDayMedicationSupplyTrue">
              <label class="form-check-label" for="hasThreeDayMedicationSupplyTrue">Yes</label>
            </div>
            <div class="form-check">
              <input type="radio" [class.is-invalid]="invalid('hasThreeDayMedicationSupply')" class="form-check-input" [value]="false" formControlName="hasThreeDayMedicationSupply" id="hasThreeDayMedicationSupplyFalse">
              <label class="form-check-label" for="hasThreeDayMedicationSupplyFalse">No</label>
            </div>
            <span [class.d-block]="invalid('hasThreeDayMedicationSupply')" class="invalid-feedback">{{e.hasThreeDayMedicationSupply}}</span>
          </div>
          <div *ngIf="form.value.hasThreeDayMedicationSupply===false" class="alert alert-warning mt-3 mb-0" role="alert">
            <p class="alert-heading h4 mt-2">Refer the evacuee to Health Services at the Reception Centre where available.</p>
          </div>
        </div>

        <!-- PETS -->
        <p class="required mt-4">
          Do you have pets with you?
        </p>
        <div class="form-group mb-0">
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('hasPets')" class="form-check-input" [value]="true" formControlName="hasPets" id="hasPetsTrue">
            <label class="form-check-label" for="hasPetsTrue">Yes</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('hasPets')" class="form-check-input" [value]="false" formControlName="hasPets" id="hasPetsFalse">
            <label class="form-check-label" for="hasPetsFalse">No</label>
          </div>
          <span [class.d-block]="invalid('hasPets')" class="invalid-feedback">{{e.hasPets}}</span>
        </div>
      </div>

      <!-- NEXT STEPS -->
      <div class="mt-4">
        <h2 class="blue-header font-weight-bold">NEXT STEPS</h2>
        <p class="required">
          While you are evacuated do you require supports?<br>
          This could be in the form of food / lodging / clothing / incidentals or transportation.
        </p>
        <div class="form-group mb-0">
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('requiresSupport')" class="form-check-input" [value]="true" formControlName="requiresSupport" id="requiresSupportTrue">
            <label class="form-check-label" for="requiresSupportTrue">Yes</label>
          </div>
          <div class="form-check">
            <input type="radio" [class.is-invalid]="invalid('requiresSupport')" class="form-check-input" [value]="false" formControlName="requiresSupport" id="requiresSupportFalse">
            <label class="form-check-label" for="requiresSupportFalse">No</label>
          </div>
          <span [class.d-block]="invalid('requiresSupport')" class="invalid-feedback">{{e.requiresSupport}}</span>
        </div>

        <div class="mt-4 feature-block" *ngIf="form.value.requiresSupport">
          <p>Check all that apply:</p>
          <div class="form-check mt-3">
            <input type="checkbox" class="form-check-input" formControlName="requiresFood" id="requiresFood">
            <label class="form-check-label" for="requiresFood">Food</label>
          </div>
          <div class="form-check mt-3">
            <input type="checkbox" class="form-check-input" value="" formControlName="requiresClothing" id="requiresClothing">
            <label class="form-check-label" for="requiresClothing">Clothing</label>
          </div>
          <div class="form-check mt-3">
            <input type="checkbox" class="form-check-input" value="" formControlName="requiresAccommodation" id="requiresLodging">
            <label class="form-check-label" for="requiresLodging">Lodging</label>
          </div>
          <div class="form-check mt-3">
            <input type="checkbox" class="form-check-input" value="" formControlName="requiresIncidentals" id="requiresIncidentals">
            <label class="form-check-label" for="requiresIncidentals">Incidentals</label>
          </div>
          <div class="form-check mt-3">
            <input type="checkbox" class="form-check-input" value="" formControlName="requiresTransportation" id="requiresTransportation">
            <label class="form-check-label" for="requiresTransportation">Transportation</label>
          </div>
        </div>
      </div>

      <!-- FAMILY RECOVERY PLANS (IMMEDIATE & LONG TERM) -->
      <div class="mb-4">
        <h2 class="blue-header font-weight-bold">FAMILY RECOVERY PLANS (IMMEDIATE &amp; LONG TERM)</h2>
        <div class="form-row">
          <app-attention-icon [alignCenter]="false"></app-attention-icon>
          <p class="col">
            Emergency Support Services provides short term assistance to give you and your family a chance to recover.<br>
            Have you thought about what you will do after that time?
          </p>
        </div>
        <textarea class="form-control" placeholder="Details" rows="4" formControlName="familyRecoveryPlan"></textarea>
      </div>

      <!-- FOLLOW-UP REQUIRED -->
      <div class="mb-4">
        <h2 class="blue-header font-weight-bold">FOLLOW-UP REQUIRED</h2>
        <div class="form-row mx-0">
          <app-attention-icon [alignCenter]="false"></app-attention-icon>
          <textarea class="form-control" placeholder="Details" rows="4" formControlName="followUpDetails"></textarea>
        </div>
      </div>

      <!-- REFERRALS MADE WITHIN RECEPTION CENTRE -->
      <div class="mb-4">
        <h2 class="blue-header font-weight-bold">REFERRALS MADE WITHIN RECEPTION CENTRE</h2>
        <div class="form-row">
          <app-attention-icon></app-attention-icon>
          <p class="col">
            Please check the boxes below where you have made referrals within the Reception Centre.
          </p>
        </div>
        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" formControlName="hasInquiryReferral" id="hasInquiryReferral">
          <label class="form-check-label" for="hasInquiryReferral">Inquiry</label>
        </div>
        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" value="" formControlName="hasHealthServicesReferral" id="hasHealthServicesReferral">
          <label class="form-check-label" for="hasHealthServicesReferral">Health Services</label>
        </div>
        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" value="" formControlName="hasFirstAidReferral" id="hasFirstAidReferral">
          <label class="form-check-label" for="hasFirstAidReferral">First Aid</label>
        </div>
        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" value="" formControlName="hasPersonalServicesReferral" id="hasPersonalServicesReferral">
          <label class="form-check-label" for="hasPersonalServicesReferral">Personal Services</label>
        </div>
        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" value="" formControlName="hasChildCareReferral" id="hasChildCareReferral">
          <label class="form-check-label" for="hasChildCareReferral">Child Care</label>
        </div>
        <div class="form-check mb3">
          <input type="checkbox" class="form-check-input" value="" formControlName="hasPetCareReferral" id="hasPetCareReferral">
          <label class="form-check-label" for="hasPetCareReferral">Pet Care</label>
        </div>
      </div>

      <!-- OTHER AGENCY REFERRALS MADE OUTSIDE OF THE RECEPTION CENTRE< -->
      <div class="mb-4">
        <h2 class="blue-header font-weight-bold">OTHER AGENCY REFERRALS MADE OUTSIDE OF THE RECEPTION CENTRE</h2>
        <div class="form-row mx-0">
          <app-attention-icon [alignCenter]="false"></app-attention-icon>
          <textarea class="form-control" placeholder="Details" rows="4" formControlName="externalReferralsDetails"></textarea>
        </div>
      </div>

      <div *ngIf="errorSummary" class="text-danger mt-5 pl-5">
        <app-font-awesome-icon icon="exclamation-triangle"></app-font-awesome-icon>
        &nbsp;{{ errorSummary }}
      </div>

      <section class="space-between align-items-center mt-5 mb-4">
        <div>
          <a href="javascript:void(0)" (click)="cancel()">
            <app-font-awesome-icon icon="times"></app-font-awesome-icon>
            <span class="ml-2">Cancel &amp; Close</span>
          </a>
        </div>
        <div>
          <button type="button" class="btn btn-primary ml-4" [disabled]="submitting" (click)="next()">
            <span *ngIf="submitting">WORKING</span>
            <span *ngIf="!submitting">NEXT</span>
          </button>
        </div>
      </section>
    </div>
  </form>
</div>

<!-- *********************************SUMMARY BELOW****************************************** -->
<div *ngIf="summaryMode">
  <!-- REVIEW DETAILS -->
  <h1 class="mt-4">Review Details</h1>

  <p>
    Please confirm that all details you entered are correct by reading through the summary below with the evacuee.
  </p>

  <ul class="summary">
    <li>
      <span class="name">Task Number:</span>
      <span class="value">{{registration?.incidentTask?.taskNumber}}</span>
    </li>
    <!-- <li>
      <span class="name">Restricted File:</span>
      <span class="value">{{registration?.restrictedAccess | yesNo}}</span>
    </li> -->
  </ul>

  <h2>Place of Registration</h2>
  <ul class="summary">
    <li>
      <span class="name">Facility Name/Registration Location:</span>
      <span class="value">{{registration?.facility}}</span>
    </li>
    <li>
      <span class="name">Host Community:</span>
      <span class="value">{{registration?.hostCommunity?.name}}</span>
    </li>
  </ul>

  <h2>Evacuee Information</h2>
  <ul class="summary">
    <li>
      <span class="name">Last Name:</span>
      <span class="value">{{registration?.headOfHousehold?.lastName}}</span>
    </li>
    <li>
      <span class="name">First Name:</span>
      <span class="value">{{registration?.headOfHousehold?.firstName}}</span>
    </li>
    <li>
      <span class="name">Initial:</span>
      <span class="value">{{registration?.headOfHousehold?.initials}}</span>
    </li>
    <li>
      <span class="name">Preferred Name:</span>
      <span class="value">{{registration?.headOfHousehold?.nickname}}</span>
    </li>
    <li>
      <span class="name">Gender:</span>
      <span class="value">{{genderOption(registration?.headOfHousehold?.gender)}}</span>
    </li>
    <li>
      <span class="name">Date of Birth:</span>
      <span class="value">{{registration?.headOfHousehold?.dob | date : 'MMM-dd-yyyy'}}</span>
    </li>
  </ul>

  <div *ngIf="registration?.headOfHousehold?.familyMembers">
    <h2>Evacuee Family Information</h2>
    <ul class="summary mt-4" *ngFor="let fm of registration.headOfHousehold.familyMembers">
      <li>
        <span class="name">Last Name:</span>
        <span class="value">{{fm?.lastName}}</span>
      </li>
      <li>
        <span class="name">First Name:</span>
        <span class="value">{{fm?.firstName}}</span>
      </li>
      <li>
        <span class="name">Initial:</span>
        <span class="value">{{fm?.initials}}</span>
      </li>
      <li>
        <span class="name">Relationship:</span>
        <span class="value">{{fm?.relationshipToEvacuee?.description}}</span>
      </li>
      <li>
        <span class="name">Gender:</span>
        <span class="value">{{genderOption(fm?.gender)}}</span>
      </li>
      <li>
        <span class="name">Date of Birth:</span>
        <span class="value">{{fm?.dob | date : 'MMM-dd-yyyy'}}</span>
      </li>
    </ul>
  </div>

  <h2>Primary Address &amp; Contact Details</h2>
  <ul class="summary">
    <ng-container *ngIf="isBcAddress(registration?.headOfHousehold?.primaryResidence); then content1 else other_content1"></ng-container>
    <ng-template #content1>
      <li>
        <span class="name">Apt/Suite/Building Number &amp; Street Address/PO Box:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.addressLine1}}</span>
      </li>
      <li>
        <span class="name">Community:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.community?.name}}</span>
      </li>
      <li>
        <span class="name">Province:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.province}}</span>
      </li>
      <li>
        <span class="name">Postal Code:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.postalCode}}</span>
      </li>
      <li>
        <span class="name">Country:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.country?.name }}</span>
      </li>
    </ng-template>
    <ng-template #other_content1>
      <li>
        <span class="name">Apt/Suite/Building Number &amp; Street Address/PO Box:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.addressLine1}}</span>
      </li>
      <li>
        <span class="name">City:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.city}}</span>
      </li>
      <li>
        <span class="name">Region/Province/State:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.province}}</span>
      </li>
      <li>
        <span class="name">Postal /ZIP Code:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.postalCode}}</span>
      </li>
      <li>
        <span class="name">Country/Region:</span>
        <span class="value">{{registration?.headOfHousehold?.primaryResidence?.country?.name }}</span>
      </li>
    </ng-template>
    <li>
      <span class="name">Telephone/Mobile:</span>
      <span class="value">{{registration?.headOfHousehold?.phoneNumber}}</span>
    </li>
    <li>
      <span class="name">Alternate Telephone/Mobile:</span>
      <span class="value">{{registration?.headOfHousehold?.phoneNumberAlt}}</span>
    </li>
    <li>
      <span class="name">Email Address:</span>
      <span class="value">{{registration?.headOfHousehold?.email}}</span>
    </li>
  </ul>

  <div *ngIf="registration?.headOfHousehold?.mailingAddress">
    <h2>Mailing Address</h2>
    <ul class="summary">
      <ng-container *ngIf="isBcAddress(registration?.headOfHousehold?.mailingAddress); then content2 else other_content2"></ng-container>
      <ng-template #content2>
        <li>
          <span class="name">Apt/Suite/Building Number &amp; Street Address/PO Box:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.addressLine1}}</span>
        </li>
        <li>
          <span class="name">Community:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.community?.name}}</span>
        </li>
        <li>
          <span class="name">Province:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.province}}</span>
        </li>
        <li>
          <span class="name">Postal Code:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.postalCode}}</span>
        </li>
        <li>
          <span class="name">Country:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.country?.name }}</span>
        </li>
      </ng-template>
      <ng-template #other_content2>
        <li>
          <span class="name">Apt/Suite/Building Number &amp; Street Address/PO Box:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.addressLine1}}</span>
        </li>
        <li>
          <span class="name">City:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.city}}</span>
        </li>
        <li>
          <span class="name">Region/Province/State:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.province}}</span>
        </li>
        <li>
          <span class="name">Postal /ZIP Code:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.postalCode}}</span>
        </li>
        <li>
          <span class="name">Country/Region:</span>
          <span class="value">{{registration?.headOfHousehold?.mailingAddress?.country?.name }}</span>
        </li>
      </ng-template>
    </ul>
  </div>

  <h2>Brief statement of how the person/family were affected by the disaster</h2>
  <ul class="summary">
    <li>
      <span>&nbsp;{{registration?.disasterAffectDetails}}</span>
    </li>
  </ul>

  <h2>Insurance</h2>
  <ul class="summary">
    <li>
      <span class="name">Do you have insurance:</span>
      <span class="value">{{insuranceOption(registration?.insuranceCode)}}</span>
    </li>
  </ul>

  <h2>Additional Information</h2>
  <ul class="summary">
    <li>
      <span class="name">Dietary Requirements:</span>
      <span class="value">{{registration?.dietaryNeeds | yesNo}}</span>
    </li>
    <li>
      <span class="name">Dietary Details:</span>
      <span class="value">{{registration?.dietaryNeedsDetails}}</span>
    </li>
    <li>
      <span class="name">Medication:</span>
      <span class="value">{{registration?.medicationNeeds | yesNo}}</span>
    </li>
    <li>
      <span class="name">Medication for 72hrs:</span>
      <span class="value">{{registration?.hasThreeDayMedicationSupply | yesNo}}</span>
    </li>
    <li>
      <span class="name">Pets:</span>
      <span class="value">{{registration?.hasPets | yesNo}}</span>
    </li>
  </ul>

  <h2>Next Steps</h2>
  <ul class="summary">
    <li>
      <span class="name">Requires Supports:</span>
      <span class="value">{{registration?.requiresSupport | yesNo}}</span>
    </li>
    <li>
      <span class="name">Supports Requested:</span>
      <span class="value">
        <div class="form-check mt-2">
          <input type="checkbox" class="form-check-input" disabled [checked]="registration?.requiresFood">
          <label class="form-check-label">Food</label>
        </div>
        <div class="form-check mt-2">
          <input type="checkbox" class="form-check-input" disabled [checked]="registration?.requiresClothing">
          <label class="form-check-label">Clothing</label>
        </div>
        <div class="form-check mt-2">
          <input type="checkbox" class="form-check-input" disabled [checked]="registration?.requiresAccommodation">
          <label class="form-check-label">Lodging</label>
        </div>
        <div class="form-check mt-2">
          <input type="checkbox" class="form-check-input" disabled [checked]="registration?.requiresIncidentals">
          <label class="form-check-label">Incidentals</label>
        </div>
        <div class="form-check mt-2">
          <input type="checkbox" class="form-check-input" disabled [checked]="registration?.requiresTransportation">
          <label class="form-check-label">Transportation</label>
        </div>
      </span>
    </li>
  </ul>

  <h2>Family Recovery Plan</h2>
  <ul class="summary">
    <li>
      <span>&nbsp;{{registration?.familyRecoveryPlan}}</span>
    </li>
  </ul>

  <h2>Referrals Made Within Reception Centre</h2>
  <ul class="summary">
    <li>
      <span class="name">Inquiry Referral:</span>
      <span class="value">{{registration?.hasInquiryReferral | yesNo}}</span>
    </li>
    <li>
      <span class="name">Health Services Referral:</span>
      <span class="value">{{registration?.hasHealthServicesReferral | yesNo}}</span>
    </li>
    <li>
      <span class="name">First Aid Referral:</span>
      <span class="value">{{registration?.hasFirstAidReferral | yesNo}}</span>
    </li>
    <li>
      <span class="name">Personal Services Referral:</span>
      <span class="value">{{registration?.hasPersonalServicesReferral | yesNo}}</span>
    </li>
    <li>
      <span class="name">Child Care Referral:</span>
      <span class="value">{{registration?.hasChildCareReferral | yesNo}}</span>
    </li>
    <li>
      <span class="name">Pet Care Referral:</span>
      <span class="value">{{registration?.hasPetCareReferral | yesNo}}</span>
    </li>
  </ul>

  <h2>Other Agency Referrals</h2>
  <ul class="summary">
    <li>
      <span>&nbsp;{{registration?.externalReferralsDetails}}</span>
    </li>
  </ul>

  <h2>Internal Case Notes</h2>
  <ul class="summary">
    <li>
      <span>&nbsp;{{registration?.followUpDetails}}</span>
    </li>
  </ul>

  <div class="mt-5 space-between">
    <section>
      <button type="button" class="btn btn-secondary" (click)="back()">EDIT REGISTRATION</button>
    </section>
    <section>
      <a routerLink="/dashboard">
        <app-font-awesome-icon icon="times"></app-font-awesome-icon>
        <span class="ml-2">Cancel &amp; Close</span>
      </a>
      <button type="button" class="btn btn-primary ml-4" [disabled]="submitting" (click)="submit()">
        <span *ngIf="submitting">SUBMITTING</span>
        <span *ngIf="!submitting">SAVE</span>
      </button>
    </section>
  </div>
</div>
